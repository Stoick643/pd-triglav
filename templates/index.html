{% extends "base.html" %}

{% block title %}Domov - PD Triglav{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section" id="hero">
    <div class="hero-background" style="background-image: url('{{ hero_image }}');"></div>
    <div class="hero-overlay"></div>
    
    <div class="container-fluid h-100">
        <div class="row h-100 align-items-center justify-content-center">
            <div class="col-12">
                <div class="hero-content text-center text-white">
                    <div class="hero-text-container">
                        <h1 class="hero-title display-3 fw-bold mb-4" data-aos="fade-up">
                            {{ hero_messaging.headline }}
                        </h1>
                        <p class="hero-subtitle lead mb-5" data-aos="fade-up" data-aos-delay="200">
                            {{ hero_messaging.subheadline }}
                        </p>
                        
                        <!-- Social Proof Stats -->
                        <div class="hero-stats mb-5" data-aos="fade-up" data-aos-delay="400">
                            <div class="row justify-content-center">
                                <div class="col-auto">
                                    <div class="stat-item">
                                        <strong>{{ club_stats.member_count }}+</strong>
                                        <small>članov</small>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <div class="stat-separator">•</div>
                                </div>
                                <div class="col-auto">
                                    <div class="stat-item">
                                        <strong>{{ club_stats.trips_this_year }}+</strong>
                                        <small>izletov letno</small>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <div class="stat-separator">•</div>
                                </div>
                                <div class="col-auto">
                                    <div class="stat-item">
                                        <strong>{{ club_stats.years_active }}.</strong>
                                        <small>jubilejno leto</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Call-to-Action Buttons -->
                        <div class="hero-cta-buttons" data-aos="fade-up" data-aos-delay="600">
                            <a href="{{ hero_messaging.primary_cta.url }}" 
                               class="btn {{ hero_messaging.primary_cta.class }} btn-lg me-4 mb-3 px-5 py-3">
                                {{ hero_messaging.primary_cta.text }}
                                <i class="bi bi-arrow-right ms-2"></i>
                            </a>
                            <a href="{{ hero_messaging.secondary_cta.url }}" 
                               class="btn {{ hero_messaging.secondary_cta.class }} btn-lg mb-3 px-5 py-3">
                                {{ hero_messaging.secondary_cta.text }}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Content Preview Bar -->
    <div class="hero-content-preview">
        <div class="preview-item">
            <i class="bi bi-clock-history"></i>
            {% if todays_event %}
                <span>Danes: {{ todays_event.title[:35] }}{% if todays_event.title|length > 35 %}...{% endif %}</span>
            {% else %}
                <span>Zgodovina se pripravlja...</span>
            {% endif %}
        </div>
        <div class="preview-divider">•</div>
        <div class="preview-item">
            <i class="bi bi-newspaper"></i>
            {% if daily_news and daily_news[0] %}
                <span>Novice: {{ daily_news[0].title[:35] }}{% if daily_news[0].title|length > 35 %}...{% endif %}</span>
            {% else %}
                <span>Novice se nalagajo...</span>
            {% endif %}
        </div>
    </div>

    <!-- Scroll Indicator -->
    <div class="hero-scroll-indicator">
        <div class="scroll-arrow bounce">
            <i class="bi bi-chevron-down"></i>
        </div>
        <small class="scroll-text">Raziskuj naprej</small>
    </div>
</section>

<!-- Main Content Section -->
<div class="container-fluid mt-5">
    <div class="row">
        <!-- Quick Info for Non-Members -->
    {% if not current_user.is_authenticated or current_user.is_pending() %}
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-info-circle text-primary"></i> O društvu
                </h5>
                <p class="card-text">
                    PD Triglav združuje planince iz vse Slovenije. Organiziramo izlete, 
                    tečaje in družabne dogodke.
                </p>
                <a href="{{ url_for('main.about') }}" class="btn btn-outline-primary">Več o nas</a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-calendar-event text-success"></i> Prihajajoči izleti
                </h5>
                <p class="card-text">
                    Redno organiziramo izlete za različne stopnje pripravljenosti. 
                    Pridruži se nam!
                </p>
                {% if not current_user.is_authenticated %}
                <small class="text-muted">Prijavi se za dostop do programa izletov.</small>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-people text-info"></i> Skupnost
                </h5>
                <p class="card-text">
                    Naša skupnost šteje preko 200 članov. Delimo izkušnje in 
                    fotografije z naših izletov.
                </p>
                {% if not current_user.is_authenticated %}
                <a href="{{ url_for('auth.register') }}" class="btn btn-outline-info">Registriraj se</a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Member Content -->
    {% if current_user.is_authenticated and current_user.can_access_content() %}
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-calendar3"></i> Prihajajoči izleti</h5>
            </div>
            <div class="card-body">
                {% if upcoming_trips %}
                    {% for trip in upcoming_trips %}
                    <div class="mb-3 {% if not loop.last %}border-bottom pb-3{% endif %}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h6 class="mb-1">
                                    <a href="{{ url_for('trips.view_trip', trip_id=trip.id) }}" class="text-decoration-none">
                                        {{ trip.title }}
                                    </a>
                                </h6>
                                <p class="mb-1 text-body-secondary small">
                                    <i class="bi bi-geo-alt me-1"></i>{{ trip.destination }}
                                </p>
                                <small class="text-body-secondary">
                                    <i class="bi bi-calendar3 me-1"></i>{{ trip.trip_date.strftime('%-d. %-m. %Y') }}
                                    {% if trip.meeting_time %}
                                        • {{ trip.meeting_time.strftime('%H:%M') }}
                                    {% endif %}
                                </small>
                            </div>
                            <div class="ms-2">
                                <span class="badge bg-{{ 'success' if trip.difficulty.value == 'easy' else 'warning' if trip.difficulty.value == 'moderate' else 'danger' if trip.difficulty.value == 'difficult' else 'dark' }}">
                                    {{ trip.difficulty.slovenian_name }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="text-center mt-3">
                        <a href="{{ url_for('trips.list_trips') }}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-calendar-event me-1"></i>Vsi izleti
                        </a>
                    </div>
                {% else %}
                    <div class="text-center py-3">
                        <i class="bi bi-calendar-x display-6 text-body-secondary mb-2"></i>
                        <p class="text-body-secondary">Trenutno ni objavljenih izletov.</p>
                        {% if current_user.role.value in ['trip_leader', 'admin'] %}
                        <a href="{{ url_for('trips.create_trip') }}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-plus-circle me-1"></i>Objavi nov izlet
                        </a>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-chat-dots"></i> Zadnje objave</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">Ni novih objav.</p>
                <!-- This will be populated when we implement trip reports -->
            </div>
        </div>
    </div>
    {% endif %}
    </div>
</div>

<!-- Historical Events and Daily News Section -->
<div class="container-fluid mt-4">
{% if True %} <!-- Temporarily show to everyone for testing -->
<div class="row mt-4">
    <!-- Historical Event Section (Left Column) -->
    <div class="col-lg-6 col-12 mb-4">
        {% if todays_event %}
        <div class="card border-primary">
            <div class="card-header bg-primary text-white">
        {% else %}
        <div class="card border-secondary">
            <div class="card-header bg-secondary text-white">
        {% endif %}
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-clock-history me-2"></i>Na ta dan v zgodovini
                    </h5>
                    <div class="header-controls">
                        {% if current_user.is_authenticated and current_user.is_admin() %}
                        <button id="regenerate-event-btn" class="btn btn-sm btn-outline-light me-2" title="Regeneriraj dogodek">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                        {% endif %}
                        <button id="toggle-history-btn" class="btn btn-sm btn-outline-light" title="Zgodovina dogodkov">
                            <i class="bi bi-archive"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                {% if todays_event %}
                    <div class="row">
                        <div class="col-md-8">
                            <h6 class="text-primary mb-2">
                                {{ todays_event.full_date_string }}
                                <span class="badge bg-{{ 'success' if todays_event.category.value == 'first_ascent' else 'warning' if todays_event.category.value == 'achievement' else 'info' if todays_event.category.value == 'expedition' else 'secondary' if todays_event.category.value == 'discovery' else 'danger' }} ms-2">
                                    {% if todays_event.category.value == 'first_ascent' %}Prva vzpon
                                    {% elif todays_event.category.value == 'achievement' %}Dosežek
                                    {% elif todays_event.category.value == 'expedition' %}Odprava
                                    {% elif todays_event.category.value == 'discovery' %}Odkritje
                                    {% elif todays_event.category.value == 'tragedy' %}Tragedija
                                    {% else %}Dogodek
                                    {% endif %}
                                </span>
                            </h6>
                            <h5 class="mb-3">{{ todays_event.title }}</h5>
                            <p class="mb-3">{{ todays_event.description }}</p>
                            
                            <div class="d-flex flex-wrap gap-3 text-muted small">
                                {% if todays_event.location %}
                                <div>
                                    <i class="bi bi-geo-alt me-1"></i>
                                    <strong>Lokacija:</strong> {{ todays_event.location }}
                                </div>
                                {% endif %}
                                {% if todays_event.people_names %}
                                <div>
                                    <i class="bi bi-people me-1"></i>
                                    <strong>Udeleženci:</strong> {{ todays_event.people_names }}
                                </div>
                                {% endif %}
                            </div>
                            
                            {% if todays_event.url or todays_event.url_secondary %}
                            <div class="mt-3">
                                {% if todays_event.url %}
                                <a href="{{ todays_event.url }}" target="_blank" class="btn btn-outline-primary btn-sm me-2">
                                    <i class="bi bi-link-45deg me-1"></i>Vir 1
                                </a>
                                {% endif %}
                                {% if todays_event.url_secondary %}
                                <a href="{{ todays_event.url_secondary }}" target="_blank" class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-link-45deg me-1"></i>Vir 2
                                </a>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 text-center d-flex align-items-center justify-content-center">
                            <div class="text-primary">
                                {% if todays_event.category.value == 'first_ascent' %}
                                    <i class="bi bi-mountain display-3"></i>
                                {% elif todays_event.category.value == 'achievement' %}
                                    <i class="bi bi-trophy display-3"></i>
                                {% elif todays_event.category.value == 'expedition' %}
                                    <i class="bi bi-compass display-3"></i>
                                {% elif todays_event.category.value == 'discovery' %}
                                    <i class="bi bi-search display-3"></i>
                                {% elif todays_event.category.value == 'tragedy' %}
                                    <i class="bi bi-heart display-3"></i>
                                {% else %}
                                    <i class="bi bi-calendar-event display-3"></i>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 pt-3 border-top">
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <i class="bi bi-robot me-1"></i>
                                Vsebina je bila {{ 'avtomatsko generirana' if todays_event.is_generated else 'ročno dodana' }}
                                {{ todays_event.created_at.strftime('%-d. %-m. %Y') if todays_event.created_at else '' }}
                            </small>
                        </div>
                    </div>
                {% else %}
                    <!-- Loading Skeleton for Historical Events -->
                    <div class="skeleton-loading">
                        <div class="skeleton-header">
                            <div class="skeleton-date"></div>
                            <div class="skeleton-badge"></div>
                        </div>
                        <div class="skeleton-title"></div>
                        <div class="skeleton-text"></div>
                        <div class="skeleton-text short"></div>
                        <div class="skeleton-meta">
                            <div class="skeleton-meta-item"></div>
                            <div class="skeleton-meta-item"></div>
                        </div>
                    </div>
                    <div class="skeleton-fallback text-center py-3 mt-3">
                        <small class="text-body-secondary">
                            <i class="bi bi-clock-history me-1"></i>
                            Vsebina se ustvarja vsak dan ob 6:05
                        </small>
                    </div>
                {% endif %}
            </div>
            
            <!-- Recent Historical Events Section (hidden by default) -->
            <div id="history-archive" class="border-top" style="display: none;">
                <div class="p-3">
                    <h6 class="mb-3">
                        <i class="bi bi-archive me-2"></i>Zadnji zgodovinski dogodki
                        {% if recent_events %}
                        <span class="text-muted small ms-2">({{ recent_events|length }} dogodkov)</span>
                        {% endif %}
                    </h6>
                    
                    {% if recent_events %}
                    <div class="list-group list-group-flush">
                        {% for event in recent_events %}
                        <div class="list-group-item border-0 px-0 py-2">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <div class="d-flex align-items-center mb-1">
                                        <span class="badge bg-light text-dark me-2">{{ event.full_date_string }}</span>
                                        <span class="badge bg-{{ 'success' if event.category.value == 'first_ascent' else 'warning' if event.category.value == 'achievement' else 'info' if event.category.value == 'expedition' else 'secondary' if event.category.value == 'discovery' else 'danger' }} me-2">
                                            {% if event.category.value == 'first_ascent' %}Prva vzpon
                                            {% elif event.category.value == 'achievement' %}Dosežek
                                            {% elif event.category.value == 'expedition' %}Odprava
                                            {% elif event.category.value == 'discovery' %}Odkritje
                                            {% elif event.category.value == 'tragedy' %}Tragedija
                                            {% else %}Dogodek
                                            {% endif %}
                                        </span>
                                    </div>
                                    <h6 class="mb-1">{{ event.title }}</h6>
                                    <p class="mb-1 text-muted small">
                                        {% if event.description|length > 150 %}
                                            {{ event.description[:150] }}...
                                        {% else %}
                                            {{ event.description }}
                                        {% endif %}
                                    </p>
                                    {% if event.location %}
                                    <small class="text-muted">
                                        <i class="bi bi-geo-alt me-1"></i>{{ event.location }}
                                    </small>
                                    {% endif %}
                                </div>
                                <div class="ms-3">
                                    <a href="{{ url_for('main.historical_event_detail', event_id=event.id) }}" 
                                       class="btn btn-outline-primary btn-sm" 
                                       title="Ogled polnega opisa">
                                        <i class="bi bi-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-3 text-body-secondary">
                        <i class="bi bi-info-circle me-2"></i>Ni zgodovinskih dogodkov za prikaz.
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Daily News Section (Right Column) -->
    <div class="col-lg-6 col-12 mb-4">
        {% if daily_news %}
        <div class="card border-success h-100">
            <div class="card-header bg-success text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-newspaper me-2"></i>Planinske novice
                    </h5>
                    {% if current_user.is_authenticated and current_user.is_admin() %}
                    <button id="refresh-news-btn" class="btn btn-sm btn-outline-light" title="Osveži novice">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                    {% endif %}
                </div>
            </div>
            <div class="card-body">
                {% for article in daily_news %}
                <div class="mb-3 {% if not loop.last %}border-bottom pb-3{% endif %}">
                    <h6 class="mb-2">
                        <a href="{{ article.url }}" target="_blank" class="text-decoration-none">
                            {{ article.title }}
                        </a>
                        <span class="badge bg-light text-dark ms-2">{{ article.language|upper }}</span>
                    </h6>
                    <p class="text-muted small mb-2">{{ article.summary }}</p>
                    <small class="text-muted">
                        <i class="bi bi-calendar3 me-1"></i>
                        {% if article.published_at %}
                            {{ article.published_at[:10] }}
                        {% else %}
                            Nedavno
                        {% endif %}
                        {% if article.source_name %}
                            • {{ article.source_name }}
                        {% endif %}
                    </small>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="card border-secondary h-100">
            <div class="card-header bg-secondary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-newspaper me-2"></i>Planinske novice
                    </h5>
                    {% if current_user.is_authenticated and current_user.is_admin() %}
                    <button id="refresh-news-btn" class="btn btn-sm btn-outline-light" title="Osveži novice">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                    {% endif %}
                </div>
            </div>
            <div class="card-body">
                <!-- Loading Skeleton for News -->
                <div class="skeleton-loading">
                    <div class="skeleton-news-item">
                        <div class="skeleton-news-title"></div>
                        <div class="skeleton-text"></div>
                        <div class="skeleton-news-meta"></div>
                    </div>
                    <div class="skeleton-divider"></div>
                    <div class="skeleton-news-item">
                        <div class="skeleton-news-title"></div>
                        <div class="skeleton-text short"></div>
                        <div class="skeleton-news-meta"></div>
                    </div>
                    <div class="skeleton-divider"></div>
                    <div class="skeleton-news-item">
                        <div class="skeleton-news-title"></div>
                        <div class="skeleton-text"></div>
                        <div class="skeleton-news-meta"></div>
                    </div>
                </div>
                <div class="skeleton-fallback text-center py-3 mt-3">
                    <small class="text-body-secondary">
                        <i class="bi bi-newspaper me-1"></i>
                        Novice se posodabljajo vsak dan ob 6:00
                    </small>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
</div>

<!-- Advanced Parallax Effects JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Advanced parallax effects
    const heroBackground = document.querySelector('.hero-background');
    const heroContent = document.querySelector('.hero-content');
    const heroStats = document.querySelector('.hero-stats');
    const heroButtons = document.querySelector('.hero-cta-buttons');
    
    if (heroBackground && heroContent) {
        let ticking = false;
        
        function updateParallax() {
            const scrolled = window.pageYOffset;
            const viewportHeight = window.innerHeight;
            const elementTop = 0; // Hero is at top
            const elementHeight = viewportHeight;
            
            // Only apply parallax when hero is visible
            if (scrolled < elementHeight) {
                const scrollProgress = scrolled / elementHeight;
                
                // Background moves slower (classic parallax)
                const bgTransform = scrolled * 0.5;
                heroBackground.style.transform = `translate3d(0, ${bgTransform}px, 0)`;
                
                // Content elements move at different speeds for depth
                const contentTransform = scrolled * 0.2;
                heroContent.style.transform = `translate3d(0, ${contentTransform}px, 0)`;
                
                // Stats move slightly faster for layered effect
                if (heroStats) {
                    const statsTransform = scrolled * 0.15;
                    heroStats.style.transform = `translate3d(0, ${statsTransform}px, 0)`;
                }
                
                // Buttons move fastest for depth separation
                if (heroButtons) {
                    const buttonsTransform = scrolled * 0.1;
                    heroButtons.style.transform = `translate3d(0, ${buttonsTransform}px, 0)`;
                }
                
                // Fade out content as user scrolls
                const fadeProgress = Math.min(scrollProgress * 1.5, 1);
                heroContent.style.opacity = 1 - fadeProgress;
            }
            
            ticking = false;
        }
        
        function requestTick() {
            if (!ticking && window.matchMedia('(prefers-reduced-motion: no-preference)').matches) {
                requestAnimationFrame(updateParallax);
                ticking = true;
            }
        }
        
        // Throttled scroll listener
        window.addEventListener('scroll', requestTick, { passive: true });
        
        // Initial call
        updateParallax();
    }
});
</script>

<!-- Advanced Hero Content Preview JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const previewBar = document.querySelector('.hero-content-preview');
    if (previewBar) {
        let isScrolling = false;
        
        // Enhanced smooth scroll with visual feedback
        previewBar.addEventListener('click', function(e) {
            // Add click animation
            previewBar.style.transform = 'translateX(-50%) scale(0.95)';
            setTimeout(() => {
                previewBar.style.transform = 'translateX(-50%) scale(1)';
            }, 150);
            
            // Smooth scroll to content
            const targetSection = document.querySelector('.container-fluid.mt-4');
            if (targetSection) {
                targetSection.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Visual feedback during scroll
                previewBar.classList.add('preview-scrolling');
                setTimeout(() => {
                    previewBar.classList.remove('preview-scrolling');
                }, 1000);
            }
        });
        
        // Enhanced entrance animation with stagger effect
        setTimeout(function() {
            previewBar.style.opacity = '0';
            previewBar.style.animation = 'previewSlideUp 0.8s ease-out forwards';
            previewBar.style.animationDelay = '2.5s';
            
            // Animate individual preview items with stagger
            const previewItems = previewBar.querySelectorAll('.preview-item');
            previewItems.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(10px)';
                item.style.animation = `previewItemFade 0.6s ease-out forwards`;
                item.style.animationDelay = `${3 + (index * 0.2)}s`;
            });
        }, 100);
        
        // Scroll-responsive preview bar
        let lastScrollY = 0;
        window.addEventListener('scroll', function() {
            if (!isScrolling) {
                window.requestAnimationFrame(function() {
                    const currentScrollY = window.pageYOffset;
                    const viewportHeight = window.innerHeight;
                    
                    // Only affect preview bar in hero section
                    if (currentScrollY < viewportHeight * 0.8) {
                        const scrollProgress = currentScrollY / (viewportHeight * 0.5);
                        const opacity = Math.max(0.3, 1 - scrollProgress);
                        
                        // Fade and slightly shrink as user scrolls
                        previewBar.style.opacity = opacity;
                        previewBar.style.transform = `translateX(-50%) scale(${Math.max(0.9, 1 - scrollProgress * 0.1)})`;
                        
                        // Subtle blur effect
                        if (scrollProgress > 0.5) {
                            previewBar.style.filter = `blur(${(scrollProgress - 0.5) * 4}px)`;
                        } else {
                            previewBar.style.filter = 'none';
                        }
                    } else {
                        // Hide completely when past hero
                        previewBar.style.opacity = '0';
                        previewBar.style.pointerEvents = 'none';
                    }
                    
                    lastScrollY = currentScrollY;
                    isScrolling = false;
                });
                isScrolling = true;
            }
        }, { passive: true });
        
        // Hover micro-interactions
        previewBar.addEventListener('mouseenter', function() {
            if (window.matchMedia('(prefers-reduced-motion: no-preference)').matches) {
                previewBar.style.animation = 'previewPulse 0.6s ease-in-out';
            }
        });
        
        previewBar.addEventListener('mouseleave', function() {
            previewBar.style.animation = 'none';
        });
    }
});

// Enhanced CSS animations for preview bar
const previewAnimationStyles = document.createElement('style');
previewAnimationStyles.textContent = `
    @keyframes previewSlideUp {
        from {
            opacity: 0;
            transform: translateX(-50%) translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    }
    
    @keyframes previewItemFade {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes previewPulse {
        0%, 100% {
            transform: translateX(-50%) scale(1);
        }
        50% {
            transform: translateX(-50%) scale(1.02);
        }
    }
    
    .preview-scrolling {
        animation: previewScrollFeedback 1s ease-out !important;
    }
    
    @keyframes previewScrollFeedback {
        0% { transform: translateX(-50%) scale(1); }
        20% { transform: translateX(-50%) scale(0.98); opacity: 0.8; }
        40% { transform: translateX(-50%) scale(1.02); opacity: 1; }
        60% { transform: translateX(-50%) scale(0.99); }
        100% { transform: translateX(-50%) scale(1); }
    }
`;
document.head.appendChild(previewAnimationStyles);
</script>

<!-- Historical Events JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Admin regenerate functionality
    const regenerateBtn = document.getElementById('regenerate-event-btn');
    if (regenerateBtn) {
        regenerateBtn.addEventListener('click', function() {
            PDTriglavConfirmModal.show(
                'Ali ste prepričani, da želite regenerirati današnji dogodek? Obstoječi dogodek bo zamenjan z novim.',
                () => regenerateEvent(),
                {
                    type: 'warning',
                    confirmText: 'Regeneriraj dogodek',
                    icon: 'bi-arrow-clockwise'
                }
            );
        });
    }

    // Admin refresh news functionality
    const refreshNewsBtn = document.getElementById('refresh-news-btn');
    if (refreshNewsBtn) {
        refreshNewsBtn.addEventListener('click', function() {
            PDTriglavConfirmModal.show(
                'Ali ste prepričani, da želite osvežiti novice? To bo trajalo nekaj sekund.',
                () => refreshNews(),
                {
                    type: 'info',
                    confirmText: 'Osveži novice',
                    icon: 'bi-arrow-repeat'
                }
            );
        });
    }

    // History toggle functionality
    const toggleHistoryBtn = document.getElementById('toggle-history-btn');
    const historyArchive = document.getElementById('history-archive');
    
    if (toggleHistoryBtn && historyArchive) {
        toggleHistoryBtn.addEventListener('click', function() {
            if (historyArchive.style.display === 'none') {
                showHistory();
            } else {
                hideHistory();
            }
        });
    }

    function regenerateEvent() {
        const btn = document.getElementById('regenerate-event-btn');
        const originalIcon = btn.innerHTML;
        
        // Show loading state
        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-arrow-clockwise spin"></i>';
        
        fetch('/admin/regenerate-today-event', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Refresh the page to show updated event
                location.reload();
            } else {
                alert('Napaka: ' + (data.error || 'Neznana napaka'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Napaka pri regeneraciji dogodka');
        })
        .finally(() => {
            btn.disabled = false;
            btn.innerHTML = originalIcon;
        });
    }

    function refreshNews() {
        const btn = document.getElementById('refresh-news-btn');
        const originalIcon = btn.innerHTML;
        
        // Show loading state
        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-arrow-clockwise spin"></i>';
        
        fetch('/admin/refresh-news', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Refresh the page to show updated news
                location.reload();
            } else {
                alert('Napaka: ' + (data.error || 'Neznana napaka'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Napaka pri osvežitvi novic');
        })
        .finally(() => {
            btn.disabled = false;
            btn.innerHTML = originalIcon;
        });
    }

    function showHistory() {
        historyArchive.style.display = 'block';
        toggleHistoryBtn.innerHTML = '<i class="bi bi-archive-fill"></i>';
    }

    function hideHistory() {
        historyArchive.style.display = 'none';
        toggleHistoryBtn.innerHTML = '<i class="bi bi-archive"></i>';
    }

    // CSRF token helper
    function getCSRFToken() {
        const token = document.querySelector('meta[name="csrf-token"]');
        return token ? token.getAttribute('content') : '';
    }
});

// Add spinner animation CSS
const style = document.createElement('style');
style.textContent = `
    .spin {
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
`;
document.head.appendChild(style);

</script>


{% endif %}
{% endblock %}