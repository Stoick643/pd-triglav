{% extends "base.html" %}

{% block title %}Objave izletov - PD Triglav{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- Page header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h2 mb-0">Objave izletov</h1>
                    <p class="text-muted">Preglejte in se prijavite na prihajajoče planinske izlete</p>
                </div>
                
                {% if current_user.is_authenticated and current_user.role.value in ['trip_leader', 'admin'] %}
                <div>
                    <a href="{{ url_for('trips.create_trip') }}" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i>Nova objava
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Filter form -->
            <div class="card mb-4">
                <div class="card-body">
                    <form method="POST" class="row g-3">
                        {{ form.hidden_tag() }}
                        
                        <div class="col-md-3">
                            {{ form.difficulty.label(class="form-label") }}
                            {{ form.difficulty(class="form-select") }}
                        </div>
                        
                        <div class="col-md-3">
                            {{ form.status.label(class="form-label") }}
                            {{ form.status(class="form-select") }}
                        </div>
                        
                        <div class="col-md-4">
                            {{ form.search.label(class="form-label") }}
                            {{ form.search(class="form-control", placeholder="Išči po naslovu ali cilju...") }}
                            <div class="form-text">{{ form.search.description }}</div>
                        </div>
                        
                        <div class="col-md-2 d-flex align-items-end">
                            {{ form.submit(class="btn btn-outline-primary w-100") }}
                        </div>
                    </form>
                </div>
            </div>

            <!-- Trips listing -->
            <div class="row">
                {% if trips %}
                    {% for trip in trips %}
                    <div class="col-lg-6 col-xl-4 mb-4">
                        <div class="card h-100 trip-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="badge bg-{{ 'success' if trip.difficulty.value == 'easy' else 'warning' if trip.difficulty.value == 'moderate' else 'danger' if trip.difficulty.value == 'difficult' else 'dark' }}">
                                        {{ trip.difficulty.slovenian_name }}
                                    </span>
                                    {% if trip.is_past %}
                                        <span class="badge bg-secondary">Preteklo</span>
                                    {% elif trip.status.value == 'cancelled' %}
                                        <span class="badge bg-danger">Odpovedan</span>
                                    {% elif trip.is_full %}
                                        <span class="badge bg-warning">Zaseden</span>
                                    {% endif %}
                                </div>
                                <small class="text-muted">{{ trip.trip_date.strftime('%d.%m.%Y') }}</small>
                            </div>
                            
                            <div class="card-body">
                                <h5 class="card-title">
                                    <a href="{{ url_for('trips.view_trip', trip_id=trip.id) }}" class="text-decoration-none">
                                        {{ trip.title }}
                                    </a>
                                </h5>
                                
                                <p class="card-text">
                                    <i class="bi bi-geo-alt text-primary me-1"></i>
                                    <strong>{{ trip.destination }}</strong>
                                </p>
                                
                                {% if trip.description %}
                                <p class="card-text text-muted small">
                                    {{ trip.description[:100] }}{% if trip.description|length > 100 %}...{% endif %}
                                </p>
                                {% endif %}
                                
                                <div class="row text-center small text-muted">
                                    <div class="col-4">
                                        <i class="bi bi-person-fill"></i><br>
                                        <span>{{ trip.confirmed_participants_count }}{% if trip.max_participants %}/{{ trip.max_participants }}{% endif %}</span>
                                    </div>
                                    <div class="col-4">
                                        <i class="bi bi-clock-fill"></i><br>
                                        <span>{{ trip.meeting_time.strftime('%H:%M') if trip.meeting_time else 'TBD' }}</span>
                                    </div>
                                    <div class="col-4">
                                        <i class="bi bi-chat-fill"></i><br>
                                        <span>{{ trip.comment_count }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-footer">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        Vodnik: {{ trip.leader.name }}
                                    </small>
                                    
                                    {% if current_user.is_authenticated and trip.can_signup %}
                                        {% set user_status = trip.get_participant_status(current_user) %}
                                        {% if user_status %}
                                            <span class="badge bg-success">Prijavljen</span>
                                        {% elif trip.can_user_signup(current_user) %}
                                            <a href="{{ url_for('trips.view_trip', trip_id=trip.id) }}" class="btn btn-sm btn-primary">
                                                Prijavi se
                                            </a>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="col-12">
                        <div class="text-center py-5">
                            <i class="bi bi-mountain display-1 text-muted"></i>
                            <h3 class="mt-3 text-muted">Ni najdenih izletov</h3>
                            <p class="text-muted">Trenutno ni objavljenih izletov, ki bi ustrezali vašim kriterijem.</p>
                            
                            {% if current_user.is_authenticated and current_user.role.value in ['trip_leader', 'admin'] %}
                            <a href="{{ url_for('trips.create_trip') }}" class="btn btn-primary mt-3">
                                <i class="bi bi-plus-circle me-2"></i>Ustvari prvi izlet
                            </a>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.trip-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.trip-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.trip-card .card-title a {
    color: inherit;
}

.trip-card .card-title a:hover {
    color: var(--bs-primary);
}
</style>
{% endblock %}